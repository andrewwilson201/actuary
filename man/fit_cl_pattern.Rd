% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_cl_pattern.R
\name{fit_cl_pattern}
\alias{fit_cl_pattern}
\title{fit chain ladder development pattern}
\usage{
fit_cl_pattern(
  cohort_var,
  dev_var,
  weighting_var,
  data,
  dev_period_length = 1,
  dev_period_units = 12,
  exclude_last_diag = FALSE,
  num_periods = NULL,
  selected_curve = "weibull",
  smooth_from = NULL,
  future_dev_periods = 5,
  exclude_points = NULL,
  cohort_start = NULL,
  tail_factor = 1,
  exclude_high = FALSE,
  exclude_low = FALSE,
  bf_prior = NULL,
  cc_decay_factor = NULL,
  premium = NULL
)
}
\arguments{
\item{cohort_var}{the variable in the input data representing the cohort}

\item{dev_var}{the variable in the input data representing the development period. needs to be consistent with dev_period_length and dev_period_units. e.g. if have half annual dev periods and data is in months (6, 12, 18 etc) then dev_period_length = 6 and dev_period_units = 1. if data in years (0.5, 1, 1.5 etc) then dev_period_length = 0.5 and dev_period_units = 12.}

\item{weighting_var}{the variable in the input data representing the amounts in the triangle e.g. claim counts or claim amounts etc}

\item{data}{the cumulative tidy dataset with the triangle data. one row per cohort year and development period. no rows for development periods beyond the last evaluation point.}

\item{dev_period_length}{the difference between subsequent development periods in the units specified in dev_period_units}

\item{dev_period_units}{the units in which dev_var is provided e.g. 1 for months, 12 for years etc.}

\item{exclude_last_diag}{defaults to FALSE. set to TRUE to exclude last diagonal}

\item{num_periods}{the number of prior periods to include in the fit. defaults to the whole triangle but set to an integer to include the last n periods instead. if last diagonal is excluded it takes the n periods prior to these. if ratios are excluded due to any other parameter settings e.g. exclude_high then the number of periods is not adjusted to allow for this e.g. if 4 most recent rows are excluded via exclude_points and num_periods is set to 5 there will only be 1 row included in the ata factor calculation.}

\item{selected_curve}{which curve to use. weibull, exponential_decay or inverse_power. defaults to weibull. only used if smooth_from is provided.}

\item{smooth_from}{optional development period to smooth from. if selected a curve is fitted to the CL ata factors and ata factors are selected from this curve beyond the development period specified. the tail factor will be estimated from this fitted curve.}

\item{future_dev_periods}{how many future development years to use when calculating the tail factor with the fitted curve. defaults to 5 years but should be set to a value such that the ata factors in the tail don't look to be truncated. only has an impact on the atu if smooth_from is provided. set to zero if you want to use a fitted curve but don't want it to estimate the tail.}

\item{exclude_points}{optional exclude individual ratios. provide as a list of indices into the ratio_table. column index should start after the cohort year column.}

\item{cohort_start}{all cohorts greater than or equal to this are included in the fit. defaults to the whole triangle if not specified.}

\item{tail_factor}{tail factor to apply. selected ata factor is set to this value at the final development period in the original data before future_dev_periods are added. hence be wary of using this in addition to using fitted curves to estimate the tail.}

\item{exclude_high}{set to 1 to exclude the highest ata ratio in each development period.}

\item{exclude_low}{set to 1 to exclude the lowest ata ratio in each development period.}

\item{bf_prior}{optional bf prior to use when calculating ultimate. can't be supplied if cc_decay_factor is provided.}

\item{cc_decay_factor}{optional cape cod decay factor to use when calculating ultimate. can't be supplied if bf_prior is provided.}

\item{premium}{required if bf_prior or cc_decay_factor is provided. dataframe with with a column called premium and another column which must have the same name as cohort_var.}
}
\value{
a list with the fitted pattern, the original input data, a triangle of individual ratios, the r_squared for the curve fits, a monthly pattern, the development units and the projected ultimates. monthly pattern is fitted using a piecewise cubic Hermite interpolating polynomial.
}
\description{
requires tidy data. one row per cell in the unprojected triangle. \cr
missing rows within the triangle will be filled in with the value in the previous period. \cr
no rows for development periods beyond the last evaluation point. \cr
data provided must be cumulative. \cr
use the plot_cl_pattern function to view fitted pattern.
}
\examples{
# fit chain ladder to example triangle data
fit_cl_pattern(uw_year, dev_year, claim_number, triangle_data)

# exclude uw years prior to 2013, exclude last diagonal, use a weibull fit to smooth from dev period 4 onewards
fit <- fit_cl_pattern(uw_year,
dev_year,
claim_number,
triangle_data,
exclude_last_diag = TRUE,
cohort_start = 2013,
smooth_from = 4)

# view the fitted pattern
plot_cl_pattern(fit)

# view the table of individual ratios
fit$ratio_table

# ratios from dev 1 to dev 2 in 2015 and dev 2 to dev 3 in 2009 look high. these are row 13, column 1 and row 7, column 2 in the ratio_table
# note that column indexing starts from dev_1 onwards (not uw_year)
# refit excluding these points
fit <- fit_cl_pattern(uw_year,
dev_year,
claim_number,
triangle_data,
exclude_points = list(c(13, 1), c(7, 2)))

}
